<!doctype html>
<html lang="cs">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MapTrack Analytics – MVP</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>

<body>
  <div class="app">

    <!-- TOP BAR -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="brand">
          <span class="brand-dot"></span>
          MapTrack Analytics
        </div>

        <div class="breadcrumb" aria-label="Breadcrumb">
          <span class="crumb" id="crumb-root">Testy</span>
          <span class="crumb-sep">›</span>
          <span class="crumb muted" id="crumb-test">—</span>
          <span class="crumb-sep">›</span>
          <span class="crumb muted" id="crumb-session">—</span>
        </div>
      </div>

      <div class="topbar-right">
        <button class="upload-chip" id="uploadSingleBtn" type="button" title="Nahraj CSV (session)">
          + Nahrát CSV (session)
        </button>
        <button class="upload-chip" id="uploadBulkBtn" type="button" title="Nahraj hromadné CSV">
          + Nahrát hromadné CSV
        </button>
        <input id="csvInput" type="file" accept=".csv" hidden />
        <input id="bulkCsvInput" type="file" accept=".csv" hidden />
      </div>
    </header>

    <!-- MAIN -->
    <main class="main">

      <!-- PAGE 1: DASHBOARD = TESTY -->
      <section class="page" id="view-dashboard">
        <div class="page-head">
          <div>
            <h1>Nástěnka</h1>
            <p class="muted">
              Nejprve vyber uživatelský test. Testy si můžeš přidat ručně a přepínat mezi nimi.
            </p>
          </div>
        </div>

        <div class="layout-2">
          <!-- LEFT: TEST LIST -->
          <section class="card">
            <div class="card-head">
              <div class="row" style="align-items:center;">
                <h2>Uživatelské testy</h2>
                <button class="btn btn-ghost" id="addTestBtn" type="button">+ Přidat test</button>
              </div>
              <div class="muted small">Kliknutím vybereš test. Tlačítkem pokračuješ na seznam sessions.</div>
            </div>

            <div class="list" id="testsList"></div>

            <div class="hint">
              <div class="hint-title">Poznámka</div>
              <div class="muted small">
                Nahrané CSV = jedna session (jeden uživatel). Hromadné CSV vytvoří jednu session pro každý <b>userid</b>
                v souboru.
              </div>
              <div id="uploadStatus" class="muted small" style="margin-top:8px;"></div>
            </div>
          </section>

          <!-- Basic metrics -->
          <section class="card">
            <div class="card-head">
              <h2>Základní metriky</h2>
              <div class="muted small">
                Na výchozí nástěnce: pouze počet sessions v rámci vybraného testu.
              </div>
            </div>

            <div class="metrics" id="testAggMetrics">
              <div class="empty">
                <div class="empty-title">Zatím nejsou data</div>
                <div class="muted small">
                  Nahraj jednu nebo více sessions (CSV). Pak se zde zobrazí počet sessions v testu.
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- PAGE: Settings -->
      <section class="page hidden" id="view-settings">
        <div class="page-head">
          <div>
            <h1>Nastavení</h1>
            <p class="muted">
              Uživatelský test: <b id="settingsTestName">—</b>
            </p>
          </div>
          <div class="page-actions">
            <button class="btn btn-ghost" id="backFromSettingsBtn" type="button">← Zpět</button>
          </div>
        </div>

        <section class="card">
          <div class="card-head">
            <h2>Správné odpovědi úloh</h2>
            <div class="muted small">
              Ke každé úloze zadej správnou odpověď (integer). Ukládá se automaticky.
            </div>
          </div>

          <div class="list" id="settingsTasksList">
            <div class="empty">
              <div class="empty-title">Zatím žádné úlohy</div>
              <div class="muted small">Nahraj aspoň jednu session (CSV), aby se načetly názvy úloh.</div>
            </div>
          </div>

          <div class="card-foot foot-split">
            <div class="muted small" id="settingsStatus">—</div>
            <button class="btn btn-ghost" id="settingsReloadBtn" type="button">Obnovit</button>
          </div>
        </section>
      </section>

      <!-- PAGE 2: SESSIONS LIST FOR SELECTED TEST -->
      <section class="page hidden" id="view-individual">
        <div class="page-head">
          <div>
            <h1>Sessions</h1>
            <p class="muted">
              Vyber session (záznam jednoho uživatele). Vpravo se zobrazí metriky a tlačítko pro pokračování na úlohy.
            </p>
          </div>

          <div class="page-actions">
            <button class="btn btn-ghost" id="backToTestsBtn" type="button">← Zpět na testy</button>
          </div>
        </div>

        <div class="layout-2">

          <!-- LEFT: SESSIONS -->
          <section class="card">
            <div class="card-head">
              <h2>Seznam sessions v testu</h2>
              <div class="muted small">Kliknutí = výběr session (nic dalšího). Tlačítko = pokračování.</div>
              <div class="filter-panel">
                <div class="filter-grid">
                  <label class="filter-field">
                    <span>Pohlaví</span>
                    <select id="sessionFilterGender"></select>
                  </label>
                  <label class="filter-field">
                    <span>Věk od</span>
                    <input id="sessionFilterAgeMin" type="number" inputmode="numeric" min="0" placeholder="např. 18" />
                  </label>
                  <label class="filter-field">
                    <span>Věk do</span>
                    <input id="sessionFilterAgeMax" type="number" inputmode="numeric" min="0" placeholder="např. 65" />
                  </label>
                  <label class="filter-field">
                    <span>Povolání</span>
                    <select id="sessionFilterOccupation"></select>
                  </label>
                  <label class="filter-field">
                    <span>Národnost</span>
                    <select id="sessionFilterNationality"></select>
                  </label>
                  <label class="filter-field">
                    <span>Vyhledat user ID</span>
                    <input id="sessionFilterUserId" type="search" placeholder="např. 12345" />
                  </label>
                </div>
                <div class="filter-actions">
                  <button class="btn btn-ghost" id="clearSessionFiltersBtn" type="button">Zrušit filtr</button>
                  <div class="muted small" id="sessionFilterSummary"></div>
                </div>
              </div>
            </div>

            <div class="list" id="sessionsList">
              <div class="empty">
                <div class="empty-title">Žádná session</div>
                <div class="muted small">Nahraj CSV na nástěnce, potom se sem sessions doplní.</div>
              </div>
            </div>
          </section>

          <!-- RIGHT: SESSION METRICS -->
          <section class="card">
            <div class="card-head">
              <h2>Metriky session</h2>
              <div class="muted small">Zde se zobrazí metriky vybrané session.</div>
            </div>

            <div class="metrics" id="sessionMetrics">
              <div class="empty">
                <div class="empty-title">Vyber session</div>
                <div class="muted small">Klikni vlevo na session, aby se zde zobrazily její metriky.</div>
              </div>
            </div>

            <div class="card-foot foot-split">
              <div class="muted small">Pokračuj na seznam úloh v této session.</div>
              <button class="btn" id="openSessionBtn" type="button" disabled>Otevřít session</button>
            </div>
          </section>
        </div>
      </section>

      <!-- PAGE 3: TASKS LIST FOR SELECTED SESSION -->
      <section class="page hidden" id="view-group">
        <div class="page-head">
          <div>
            <h1>Úlohy v session</h1>
            <p class="muted">
              V této session je více úloh (sloupec <b>task</b>). Klikni na úlohu a zobraz metriky v pop-up okně.
            </p>
          </div>

          <div class="page-actions">
            <button class="btn btn-ghost" id="backToSessionsBtn" type="button">← Zpět na sessions</button>
          </div>
        </div>

        <div class="layout-2">

          <!-- LEFT: TASKS -->
          <section class="card">
            <div class="card-head">
              <h2>Seznam úloh</h2>
              <div class="muted small">Kliknutí na úlohu otevře metriky (pop-up).</div>
            </div>

            <div class="list" id="tasksList">
              <div class="empty">
                <div class="empty-title">Vyber nejdřív session</div>
                <div class="muted small">Úlohy se načtou až po výběru session v předchozím kroku.</div>
              </div>
            </div>
          </section>

          <!-- RIGHT: PLACEHOLDERS FOR FUTURE -->
          <section class="card">
            <div class="card-head">
              <h2>Detail (později)</h2>
              <div class="muted small">Sem později přijde individuální pohled: mapa, soc-dem info…</div>
            </div>

            <div class="stack">
              <!-- ADDITIVE: button to open timeline -->
              <div class="placeholder-box">
                <div class="row" style="justify-content:space-between; align-items:center; gap:12px;">
                  <div class="muted small">Timeline eventů pro celou session.</div>
                  <button class="btn" id="openTimelineBtn" type="button">Časová osa eventů</button>
                </div>
              </div>

              <div class="placeholder-box">Mapa (trajektorie + viewpointy)</div>
              <div class="placeholder-box">Soc-dem info</div>
            </div>
          </section>
        </div>
      </section>

    </main>

    <!-- TASK METRICS MODAL (pop-up) -->
    <div class="modal hidden" id="taskMetricsModal" role="dialog" aria-modal="true" aria-labelledby="taskModalTitle">
      <div class="modal-backdrop"></div>

      <div class="modal-card">
        <div class="modal-head">
          <div>
            <div class="modal-title" id="taskModalTitle">Metriky úlohy</div>
            <div class="muted small" id="taskModalSubtitle">—</div>
          </div>
          <button class="icon-btn" id="closeTaskModalBtn" type="button" aria-label="Zavřít">✕</button>
        </div>

        <div class="modal-body">
          <div class="metrics" id="taskModalMetrics">
            <div class="empty">
              <div class="empty-title">Zatím nic</div>
              <div class="muted small">Po kliknutí na úlohu se zde zobrazí její metriky.</div>
            </div>
          </div>
        </div>

        <div class="modal-foot">
          <button class="btn btn-ghost" id="closeTaskModalBtn2" type="button">Zavřít</button>
        </div>
      </div>
    </div>

    <!-- NEW: TIMELINE MODAL -->
    <div class="modal hidden" id="timelineModal" role="dialog" aria-modal="true" aria-labelledby="timelineModalTitle">
      <div class="modal-backdrop" id="timelineModalBackdrop"></div>

      <!-- wide modal-card using inline style (no CSS changes) -->
      <div class="modal-card" style="width:min(1200px, 94vw);">
        <div class="modal-head">
          <div>
            <div class="modal-title" id="timelineModalTitle">Časová osa eventů</div>
            <div class="muted small" id="timelineModalSubtitle">—</div>
          </div>
          <button class="icon-btn" id="closeTimelineBtn" type="button" aria-label="Zavřít">✕</button>
        </div>

        <div class="modal-body">
          <div class="muted small" style="margin-bottom:10px;">
            Barevné segmenty = intervaly (MOVE/ZOOM), svislé čárky = bodové eventy. Hover ukáže detail.
          </div>

          <div id="timelineContent">
            <div class="empty">
              <div class="empty-title">Zatím nic</div>
              <div class="muted small">Otevři timeline nad vybranou session.</div>
            </div>
          </div>
        </div>

        <div class="modal-foot">
          <button class="btn btn-ghost" id="closeTimelineBtn2" type="button">Zavřít</button>
        </div>
      </div>
    </div>
    
    <div class="modal hidden" id="uploadTestModal" role="dialog" aria-modal="true" aria-labelledby="uploadTestTitle">
      <div class="modal-backdrop" id="uploadTestModalBackdrop"></div>

      <div class="modal-card">
        <div class="modal-head">
          <div>
            <div class="modal-title" id="uploadTestTitle">Vyber test pro CSV</div>
            <div class="muted small">CSV se nahraje pouze do zvoleného testu.</div>
          </div>
          <button class="icon-btn" id="closeUploadTestBtn" type="button" aria-label="Zavřít">✕</button>
        </div>

        <div class="modal-body">
          <label class="filter-field" style="gap:6px;">
            <span>Test</span>
            <select id="uploadTestSelect"></select>
          </label>
        </div>

        <div class="modal-foot">
          <button class="btn btn-ghost" id="cancelUploadTestBtn" type="button">Zrušit</button>
          <button class="btn" id="confirmUploadTestBtn" type="button">Pokračovat</button>
        </div>
      </div>
    </div>

  </div>

  <script src="/static/app.js?v=7"></script>
</body>

</html>